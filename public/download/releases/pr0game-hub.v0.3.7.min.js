// ==UserScript==
// @name         pr0game Hub (aka hornyHub)
// @namespace    http://tampermonkey.net/
// @version      0.3.7
// @description  alliance hub using cloud
// @author       esKju <info@sq-webdesign.de>
// @match        https://pr0game.com/game.php?*
// @match        https://www.pr0game.com/game.php?*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_xmlhttpRequest
// ==/UserScript==
!function(){"use strict";let e=GM_getValue("api_key"),t=(GM_getValue("api_key_valid"),"1"===GM_getValue("debug_mode")),a="1"===GM_getValue("developer_mode")?"http://pr0game-hub.local/":"https://pr0game-hub.esKju.net/";const i=[22,22,24],n=[242,245,244],l=[238,77,46],r=[136,136,136],s=[255,0,130],o=[92,184,92],d=[0,143,255],c=[247,197,22],g=[0,255,255];window.getCoordinates=function(e){return!!e&&e.match(/\[([0-9]+)\:([0-9]+)\:([0-9]+)\]/)},window.isNewerVersionAvailable=function(e){const t="0.3.7".split("."),a=e.split(".");return getInt(a[0])>getInt(t[0])||!(getInt(a[0])<getInt(t[0]))&&(getInt(a[1])>getInt(t[1])||!(getInt(a[1])<getInt(t[1]))&&getInt(a[2])>getInt(t[2]))};const p=getCoordinates($("#planetSelector option:selected").html()),h=p[1],u=p[2],_=p[3];let f=null,y=[],m=null,b=null,w=null,v=null;window.getJSON=function(i,n){return i=a+i+"?api_key="+e+"&version=0.3.7",t&&console.log("GET",i),GM_xmlhttpRequest({method:"GET",url:i,onload:function(e){t&&console.log(e.responseText),n(e)}})},window.postJSON=function(i,n,l){return i=a+i+"?api_key="+e+"&version=0.3.7",t&&console.log("POST",i,n),GM_xmlhttpRequest({method:"POST",data:JSON.stringify(n),url:i,headers:{"Content-Type":"application/json"},onload:function(e){t&&console.log(e.status),l(e)},onerror:function(e){t&&console.log(e.status)}})},window.parseUrl=function(){$("head").append('<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>');const e=window.location.href.replace("www.","");"https://pr0game.com/game.php"===e||0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=overview/)?(m=new PageOverview).init():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=statistics/)?parsePageStatistics():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=messages/)?parsePageMessages():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=galaxy/)?parsePageGalaxy():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=playerCard/)?parsePagePlayerCard():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=alliance/)?parsePageAlliance():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=buildings/)?(b=new PageBuildings).init():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=research/)?(w=new PageResearch).init():0===e.search(/https\:\/\/pr0game\.com\/game\.php\?page\=fleetTable/)&&(v=new PageFleet).init()},window.PageFleet=function(){this.data=[],this.init=function(){const e=this,t=[];let a,i,n,l;$(".table519 tr").each(function(e,i){(a=$(i).html().replace(/\n/,"").match(/id\=\"ship([0-9]+)\_value\"\>([\.0-9]+)\</))&&t.push({ship_id:getInt(a[1]),amount:getInt(a[2])})}),$("content > table:first-child > tbody > tr").each(function(e,r){$(r).find("td").length>1&&(i=$(r).find("td:nth-child(3)").html(),n=$(r).find("td:nth-child(4)").html().match(/\[([0-9]+)\:([0-9]+)\:([0-9]+)\]/),(l=i.match(/\'\>([^<]+)\:\<\/td\>\<td class\=\'transparent\'\>([\.0-9]+)\</g))&&n[1]==h&&n[2]==u&&n[3]==_&&$.each(l,function(e,i){(a=i.match(/\'\>([^<]+)\:\<\/td\>\<td class\=\'transparent\'\>([\.0-9]+)\</))&&t.push({ship_id:a[1],amount:getInt(a[2])})}))}),postJSON("planets/fleet",{coordinates:h+":"+u+":"+_,fleet:t},function(t){e.data=JSON.parse(t.responseText);let a='<br><table class="table 519" style="max-width: 519px !important"><tr><th style="text-align: left">Schiffstyp</th><th style="text-align: right">Anzahl (planetübergreifend)</th></tr>';$.each(e.data,function(e,t){a+='<tr><td style="text-align: left">'+t.name+'</td><td style="text-align: right">'+t.sum+"</td></tr>"}),$("content").append(a+'</table><p style="max-width: 519px !important; margin: 10px auto"><i>Diese Anzahl der stationierten und in der Luft befindlichen Schiffe (Aktiver Planet = Startplanet) wird aktualisiert, sobald die entsprechende Flottenseite des Planeten geöffnet wird.<br><br>Nach Kampf mit Verlust, werden die verlorenen Schiffe also erst nach Aufruf der Flottenansicht am Startplaneten aktualisiert. Nach Schiffsbau v.v.<br><br>Nach erfolgreicher Stationierung müssen somit die Flottenseiten von Start- und Zielplanet zur Aktualisierung geöffnet werden.</i></p>')})}},window.PageBuildings=function(){this.data=[],this.init=function(){const e=this,t=[];let a,i;$(".buildn").each(function(e,n){a=$(n).html().match(/\.info\(([0-9]+)\)\"\>([^<]+)\<\/a\>/),i=$(n).html().match(/\(Stufe ([0-9]+)\)/),t.push({building_id:getInt(a[1]),level:i?getInt(i[1]):0})}),postJSON("planets/buildings",{coordinates:h+":"+u+":"+_,buildings:t},function(t){e.data=JSON.parse(t.responseText),$(".buildn").each(function(t,i){a=$(i).html().match(/\.info\(([0-9]+)\)\"\>([^<]+)\<\/a\>/),$(i).append("// Max: "+e.data[a[1]].max_level),e.data[a[1]].max_level>0&&$(i).append(" ("+e.data[a[1]].player_names+")")})})}},window.PageResearch=function(){this.data=[],this.init=function(){const e=this,t=[];let a,i;$(".buildn").each(function(e,n){a=$(n).html().match(/\.info\(([0-9]+)\)\"\>([^<]+)\<\/a\>/),i=$(n).html().match(/\(Stufe ([0-9]+)\)/),t.push({research_id:getInt(a[1]),level:i?getInt(i[1]):0})}),postJSON("players/research",{research:t},function(t){e.data=JSON.parse(t.responseText),$(".buildn").each(function(t,i){a=$(i).html().match(/\.info\(([0-9]+)\)\"\>([^<]+)\<\/a\>/),$(i).append("// Max: "+e.data[a[1]].max_level),e.data[a[1]].max_level>0&&$(i).append(" ("+e.data[a[1]].player_names+")")})})}},window.PageOverview=function(){this.isLoading=!1,this.cacheKey="overviewData",this.container=null,this.request=null,this.fleetQueue=[],this.init=function(){this.parseOwnAttacks(),this.prepareHtml(),this.renderHtml(),this.loadData(),this.bindHotkeys()},this.bindHotkeys=function(){const e=this,t={i:"filter_inactive",n:"filter_noobs",u:"filter_vacation",a:"filter_alliance",s:"filter_spy_report",k:"filter_battle_report"},a={p:"filter_score_enable",g:"filter_score_building_enable",f:"filter_score_science_enable",m:"filter_score_fleet_enable",v:"filter_score_defense_enable",i:"filter_inactive_since_enable",k:"filter_last_battle_report_enable",s:"filter_last_spy_report_enable",q:"filter_metal_enable",w:"filter_crystal_enable",e:"filter_deuterium_enable"};$(window).keypress(function(i){const n=i.key.toLowerCase();let l=null;if(0===$("*:focus").length){if(i.shiftKey){if(a[n]){switch(GM_getValue(a[n])){case"0":l="1";break;default:l="0"}GM_setValue(a[n],l)}}else if(t[n]){switch(GM_getValue(t[n])){case"HIDE":l="ONLY";break;case"ONLY":l="ALL";break;default:l="HIDE"}GM_setValue(t[n],l)}e.renderHtml()}})},this.setLoading=function(e){this.isLoading=e},this.prepareHtml=function(){$(".infos:last-child").css("margin-top","-17px"),this.container=$(".infos:last-child"),this.container.html('<div style="padding: 15px"><i class="fa fa-spinner fa-spin"></i> Loading overview...</div>')},this.checkVersion=function(){var e=this.getData();e&&isNewerVersionAvailable(e.version)&&$("body").prepend('<div style="padding: 10px 15px; background: '+getRgb(l)+"; color: "+getRgb(n)+'; z-index: 10000; position: fixed; top: 0; left: 0; right: 0;" id="progress-bar"><i class="fa fa-exclamation-triangle"></i>  Eine neue Plugin-Version v<a href="https://pr0game-hub.eskju.net/download/releases/pr0game-hub.v'+e.version+'.js" target="_blank" download>'+e.version+"</a> ist verf&uuml;gbar.</div>")},this.parseOwnAttacks=function(){var e=this;let t=null;$("#hidden-div2 > li > span:last-child").each(function(a,i){(i=$(i)).hasClass("ownattack")&&(t=$(i).find(".ownattack"),e.fleetQueue.push({from:$(t[1]).html().replace(/\[(.*)\]/,"$1"),to:$(t[2]).html().replace(/\[(.*)\]/,"$1"),type:i.attr("class"),time:$(i).parent().find("span.fleets")})),i.hasClass("ownespionage")&&(t=$(i).find(".ownespionage"),e.fleetQueue.push({from:$(t[1]).html().replace(/\[(.*)\]/,"$1"),to:$(t[2]).html().replace(/\[(.*)\]/,"$1"),type:i.attr("class"),time:$(i).parent().find("span.fleets")}))})},this.loadData=function(){var e=this;null!==this.request&&this.request.abort(),this.setLoading(!0),this.request=postJSON("players/overview",{galaxy:h,system:u,planet:_,order_by:GM_getValue("orderBy"),order_direction:GM_getValue("orderDirection"),date_for_humans:"1"===(GM_getValue("date_for_humans")||"0")},function(t){GM_setValue(e.cacheKey,t.responseText),e.setLoading(!1),e.checkVersion(),e.renderHtml()})},this.getData=function(){var e=GM_getValue(this.cacheKey);try{var t=this.sortData,a=JSON.parse(e);return a.players=a.players.sort(t),a}catch(e){return{players:[],outdated_ids:[],version:"0.3.7",player:null}}},this.bindFilters=function(){$(".phFilter").each(function(e,t){$(t).on("change",function(){"checkbox"===$(this).attr("type")?savePhOption($(this).attr("data-alias"),$(this)[0].checked?"1":"0"):savePhOption($(this).attr("data-alias"),$(this).val())})})},this.bindHeadlineSort=function(){var e=this;$("th.sortable").each(function(t,a){$(a).css("cursor","pointer"),$(a).attr("data-sort")==(GM_getValue("orderBy")||"distance")&&$(a).attr("data-direction")==(GM_getValue("orderDirection")||"ASC")&&$(a).prepend(e.isLoading?'<i class="fa fa-spin fa-spinner fa"></i> ':'<i class="fa fa-caret-down"></i> '),$(a).click(function(){e.orderBy($(a).attr("data-sort"),$(a).attr("data-direction")),e.renderHtml()})})},this.orderBy=function(e,t){GM_setValue("orderBy",e),GM_setValue("orderDirection",t)},this.sortData=function(e,t){let a=GM_getValue("orderBy")||"distance";const i="DESC"!==GM_getValue("orderDirection")?1:-1,n=a.split(".");2===n.length&&(e=e[n[0]],t=t[n[0]],a=n[1]);let l=e[a]||"",r=t[a]||"";return"alliance_name"!==a&&"name"!==a&&(l=getInt(l),r=getInt(r)),(l<r?-1:l>r?1:0)*i},this.applyRowStyles=function(e){$(e.players).each(function(t,a){var i=$("#row"+a.id),n=$(i).find("td"),l=i.find("td a");e.player&&i.css(getPlayerRowStyle(a.player,e.player.score)),$(n[6]).css(getPlayerScoreStyle(a.player,e.player)),$(n[7]).css(getPlayerScoreBuildingStyle(a.player,e.player)),$(n[8]).css(getPlayerScoreScienceStyle(a.player,e.player)),$(n[9]).css(getPlayerScoreMilitaryStyle(a.player,e.player)),$(n[10]).css(getPlayerScoreDefenseStyle(a.player,e.player)),e.player&&l.css(getPlayerRowTdStyle(a.player,e.player.score,e.player)),e.player&&l.css(getPlayerRowTdStyle(a.player,e.player.score,e.player)),$("#lastSpyReport"+a.id).click(function(){getJSON("spy-reports/"+a.galaxy+"/"+a.system+"/"+a.planet,function(e){e=JSON.parse(e.responseText),showSpyReportHistory(e)})})})},this.bindSettingsLink=function(){var e=this;$("#showSettings").click(function(){GM_setValue("hideSettings","0"),$("#phSettings").show(),e.renderHtml()}),$("#hideSettings").click(function(){GM_setValue("hideSettings","1"),$("#phSettings").show(),e.renderHtml()})},this.bindSpyLinks=function(){$(".spio-link").click(function(){$.getJSON("game.php?page=fleetAjax&ajax=1&mission=6&planetID="+$(this).attr("data-id"),function(e){showMessage(e.mess,600===e.code?"success":"danger")})})},this.checkUpdatableIds=function(e){e.outdated_ids.length>0&&3==h&&227==u&&10==_&&(this.container.prepend('<button id="fetchMissingIdsBtn">Fetch '+e.outdated_ids.length+" outdated IDs</button>"),$("#fetchMissingIdsBtn").click(function(){y=e.outdated_ids,$("#fetchMissingIdsBtn").remove(),processQueue()}))},this.renderHtml=function(){var e=this,t='<table width="100%" style="max-width: 100% !important" class="table519"><tr>',a=this.getData();if(updateConfigVars(),!a)return;t+='<th style="text-align: center;">#</th>',t+='<th class="sortable" data-sort="alliance_name" data-direction="ASC">Ally</th>',t+='<th class="sortable" data-sort="player.name" data-direction="ASC">Spieler</th>',t+='<th class="sortable" data-sort="distance" title="Distanz" data-direction="ASC" style="text-align: center;" id="sortByDistance" colspan="3"><i class="fa fa-map-marker-alt"></i></th>',t+='<th class="sortable" data-sort="player.score" title="Punkte" data-direction="DESC" style="text-align: center; color: '+getRgb(d)+'" id="sortByScore"><i class="fa fa-chart-line"></i></th>',t+='<th class="sortable" data-sort="player.score_building" title="Gebaeudepunkte" data-direction="DESC" style="text-align: center; color: '+getRgb(o)+'" id="sortByScoreBuilding"><i class="fa fa-home"></i></th>',t+='<th class="sortable" data-sort="player.score_science" title="Forschungspunkte" data-direction="DESC" style="text-align: center; color: '+getRgb(s)+'" id="sortByScoreScience"><i class="fa fa-flask"></i></th>',t+='<th class="sortable" data-sort="player.score_military" title="Militaerpunkte" data-direction="DESC" style="text-align: center; color:'+getRgb(l)+'" id="sortByScoreMilitary"><i class="fa fa-fighter-jet"></i></th>',t+='<th class="sortable" data-sort="player.score_defense" title="Verteidigungspunkte" data-direction="DESC" style="text-align: center; color: '+getRgb(c)+'" id="sortByScoreDefense"><i class="fa fa-shield"></i></th>',t+='<th class="sortable" data-sort="last_battle_report_hours" title="Letzter Angriff" data-direction="ASC" style="text-align: right;">Attack <i class="fa fa-crosshairs"></i></th>',t+='<th class="sortable" data-sort="last_spy_report_hours" title="Letze Spionage" data-direction="DESC" style="text-align: right;">Spy <i class="fa fa-user-secret"></i></th>',t+='<th style="text-align: center;">Actions</th>',t+='<th class="sortable" data-sort="last_spy_metal" data-direction="DESC" title="Metall (Letzte Spionage)" style="text-align: right;" id="sortBySpioMet">MET</th>',t+='<th class="sortable" data-sort="last_spy_crystal" data-direction="DESC" title="Kristall (Letzte Spionage)" style="text-align: right;" id="sortBySpioCry">CRY</th>',t+='<th class="sortable" data-sort="last_spy_deuterium" data-direction="DESC" title="Deuterium (Letzte Spionage)" style="text-align: right;" id="sortBySpioDeu">DEU</th></tr>',null!==a.player&&(f=a.player);let r=0;$(a.players).each(function(s,o){if(filterTableRow(o,a.player)){r++,t+='<tr id="row'+o.id+'">',t+="<td>"+r+"</td>",t+='<td style="text-align: left; max-width: 50px"><div style="max-width: 50px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(o.alliance_name||"---")+"</div></td>",t+='<td style="text-align: left; max-width: 100px"><div style="max-width: 100px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">',null!==o.inactive_since&&o.inactive_since<48&&(t+='<span style="padding: 2px 5px; border-radius: 2px; background: '+getRgb(l)+"; color: "+getRgb(n)+'; border-radius: 2px; margin-right: 5px; font-size: 10px;">'+o.inactive_since+"H</span>"),t+='<a href="/game.php?page=playerCard&id='+o.player.id+'">'+o.player.name+"</a></div></td>",t+='<td id="row'+o.id+'Galaxy">'+(o.galaxy||"---")+"</td>",t+='<td id="row'+o.id+'System"><a href="/game.php?page=galaxy&galaxy='+(o.galaxy||"")+"&system="+(o.system||"")+'">'+(o.system||"---")+"</a></td>",t+='<td id="row'+o.id+'Planet">'+(o.planet||"---")+"</td>",t+='<td id="row'+o.id+'Score">'+(o.player.score||"")+"</td>",t+='<td id="row'+o.id+'ScoreBuilding">'+(o.player.score_building||"")+"</td>",t+='<td id="row'+o.id+'ScoreScience">'+(o.player.score_science||"")+"</td>",t+='<td id="row'+o.id+'ScoreMilitary">'+(o.player.score_military||"")+"</td>",t+='<td id="row'+o.id+'ScoreDefense">'+(o.player.score_defense||"")+"</td>",t+='<td style="text-align: right">';var d=0;$.each(e.fleetQueue,function(e,a){if(a.to==o.coordinates||a.from==o.coordinates)switch(a.type){case"flight ownattack":t+='<div style="text-align: center; background: '+getRgb(l)+"; margin-bottom: -1px; color: "+getRgb(n)+'; border-radius: 2px; padding: 2px 5px; font-size: 10px;">'+a.time[0].outerHTML+"</div>",d++;break;case"return ownattack":t+='<div style="text-align: center; background: '+getRgb(i)+"; color: "+getRgb(l)+"; outline: 1px solid "+getRgb(l)+'; outline-offset: -1px; border-radius: 2px; padding: 2px 5px; font-size: 10px;">'+a.time[0].outerHTML+"</div>",d++;break;case"flight ownespionage":t+='<div style="text-align: center; background: '+getRgb(c)+"; margin-bottom: -1px; color: "+getRgb(i)+'; border-radius: 2px; padding: 2px 5px; font-size: 10px;">'+a.time[0].outerHTML+"</div>",d++;break;case"return ownespionage":t+='<div style="text-align: center; background: '+getRgb(i)+"; color: "+getRgb(c)+"; outline: 1px solid "+getRgb(c)+'; outline-offset: -1px; border-radius: 2px; padding: 2px 5px; font-size: 10px;">'+a.time[0].outerHTML+"</div>",d++}}),t+=0===d&&o.last_battle_report||"",t+=" </td>",t+='<td style="text-align: right; cursor: pointer" id="lastSpyReport'+o.id+'">'+(o.last_spy_report||"")+"</td>",t+="<td>",o.external_id?t+='[<a class="spio-link" data-id="'+o.external_id+'" style="cursor: pointer">S</a>]':t+=' [<a style="color: #666" href="/game.php?page=fleetTable&galaxy='+o.galaxy+"&system="+o.system+"&planet="+o.planet+'&planettype=1&target_mission=6" style="cursor: pointer">S</a>]',t+=' [<a  href="/game.php?page=fleetTable&galaxy='+o.galaxy+"&system="+o.system+"&planet="+o.planet+'&planettype=1&target_mission=1" style="cursor: pointer">A</a>]',t+="</td>",t+='<td style="text-align: right;">'+(o.last_spy_metal||"")+"</td>",t+='<td style="text-align: right;">'+(o.last_spy_crystal||"")+"</td>";var g=Math.ceil(getInt(o.last_spy_metal)/2+getInt(o.last_spy_crystal)/2+getInt(o.last_spy_deuterium)/2);t+='<td style="text-align: right;" title="'+Math.ceil(g/5e3)+" KT, "+g+' raidable">'+(o.last_spy_deuterium||"")+"</td>",t+="</tr>"}}),this.container.html(getOverviewHeader()+t+"</table>"),this.bindFilters(),this.applyRowStyles(a),this.bindHeadlineSort(),this.bindSettingsLink(),this.bindSpyLinks(),this.checkUpdatableIds(a)}},window.parsePageStatistics=function(){var e=[],t=[],a=[];$(".table519:nth-child(2) tr").each(function(i,n){if(i>0){var l=parseInt($(n).find("td:nth-child(2) a").attr("onclick").replace(/return Dialog\.Playercard\((.*)\, (.*)\);/,"$1"));e.push(l),$(n).attr("id","row"+l),$(n).find("td:nth-child(2) .galaxy-short-inactive").length>0&&t.push(l),$(n).find("td:nth-child(2) .galaxy-short-vacation").length>0&&a.push(l)}else $(n).append("<th>Koords</th>"),$(n).append("<th>B</th>"),$(n).append("<th>S</th>"),$(n).append("<th>M</th>"),$(n).append("<th>D</th>")}),postJSON("players/stats",{ids:e,inactive_ids:t,vacation_ids:a,order_by:GM_getValue("orderBy")},function(e){e=JSON.parse(e.responseText),$(e.players).each(function(t,a){var i=$("#row"+a.id);i.append('<td id="row'+a.id+'Coordinates">'+(a.main_coordinates||"---")+"</td>"),i.append('<td id="row'+a.id+'ScoreBuilding">'+(a.score_building||"")+"</td>"),i.append('<td id="row'+a.id+'ScoreScience">'+(a.score_science||"")+"</td>"),i.append('<td id="row'+a.id+'ScoreMilitary">'+(a.score_military||"")+"</td>"),i.append('<td id="row'+a.id+'ScoreDefense">'+(a.score_defense||"")+"</td>"),i.css(getPlayerRowStyle(a)),$("#row"+a.id+" td:nth-child(5)").css(getPlayerScoreStyle(a,e.player)),$("#row"+a.id+"ScoreBuilding").css(getPlayerScoreBuildingStyle(a,e.player)),$("#row"+a.id+"ScoreScience").css(getPlayerScoreScienceStyle(a,e.player)),$("#row"+a.id+"ScoreMilitary").css(getPlayerScoreMilitaryStyle(a,e.player)),$("#row"+a.id+"ScoreDefense").css(getPlayerScoreDefenseStyle(a,e.player))}),e.missing_ids.length>0&&3==h&&227==u&&($("content").prepend('<button id="fetchMissingIdsBtn">Fetch '+e.missing_ids.length+" missing IDs</button>"),$("#fetchMissingIdsBtn").click(function(){y=e.missing_ids,$("#fetchMissingIdsBtn").remove(),processQueue()})),e.outdated_ids.length>0&&3==h&&227==u&&($("content").prepend('<button id="fetchUpdatableIdsBtn">Fetch '+e.outdated_ids.length+" outdated IDs</button>"),$("#fetchUpdatableIdsBtn").click(function(){y=e.outdated_ids,$("#fetchMissingIdsBtn").remove(),processQueue()}))})},window.parsePageMessages=function(){var e=$($("#messagestable > tbody > tr").get().reverse());e.each(function(t,a){if($(a).find(".spyRaport").length>0){$(e[t-1]).find("td:nth-child(2)").html();var i=$(a).find(".spyRaportHead a").html(),n=((o=i.match(/Spionagebericht von (.*) \[([0-9]+)\:([0-9]+)\:([0-9]+)\] am (.*)/,i))[2],o[3],o[4],o[5],$(a).find(".spyRaportContainerRow .spyRaportContainerCell:nth-child(2n+1)")),l=$(a).find(".spyRaportContainerRow .spyRaportContainerCell:nth-child(2n)"),r={};n.each(function(e,t){r[($(t).find("a").attr("onclick")||"").match(/\(([0-9]+)\)/)[1]]=getInt($(l[e]).html())}),postJSON("spy-reports",{id:parseInt($(a).attr("class").match(/message\_([0-9]+)/)[1]),galaxy:parseInt(o[2]),system:parseInt(o[3]),planet:parseInt(o[4]),timestamp:o[5],resources:r},function(e){})}if($(a).find(".raportMessage").length>0){var s=$(a).html(),o=getCoordinates($(a).find(".raportMessage").html());console.log(s),postJSON("battle-reports",{report_id:s.match(/(raport|report)\=([^"]{32})/)[2],galaxy:parseInt(o[1]),system:parseInt(o[2]),planet:parseInt(o[3]),attacker_lost:getInt(s.match(/Angreifer\: ([\.0-9]+)\</)[1]),defender_lost:getInt(s.match(/Verteidiger\: ([\.0-9]+)\</)[1]),metal:getInt(s.match(/(reportSteal|raportSteal) element901\"\>([\.0-9]+)\</)[2]),crystal:getInt(s.match(/(reportSteal|raportSteal) element902\"\>([\.0-9]+)\</)[2]),deuterium:getInt(s.match(/(reportSteal|raportSteal) element903\"\>([\.0-9]+)\</)[2]),debris_metal:getInt(s.match(/(reportDebris|raportDebris) element901\"\>([\.0-9]+)\</)[2]),debris_crystal:getInt(s.match(/(reportDebris|raportDebris) element902\"\>([\.0-9]+)\</)[2]),timestamp:$(e[t+1]).find("td:nth-child(2)").html()},function(e){})}})},window.parsePageGalaxy=function(){$("tr td:nth-child(2) a.tooltip_sticky").each(function(e,t){var a=$(t).attr("data-tooltip-content"),i=$(t).parent().parent().find("td:nth-child(6) a").attr("data-tooltip-content").match(/Dialog\.Buddy\(([0-9]+)\)/);i=i?parseInt(i[1]):null;var n=a.match(/([0-9]+)\:([0-9]+)\:([0-9]+)/,a),l=a.match(/doit\(6\,([0-9]+)/,a);l=l?parseInt(l[1]):null,n&&l&&postJSON("planets",{coordinates:n[0],planet_id:l,player_id:i},function(e){})})},window.parsePagePlayerCard=function(){var e=($("#content tr:nth-child(4) a").attr("onclick")||"").match(/\&id\=([0-9]+)/),t=window.location.href.match(/[\?\&]id=([(0-9]+)/i)[1];postJSON("players/"+t,{name:$("#content tr:nth-child(2) td:nth-child(2)").html(),alliance_id:e?e[1]:null,alliance_name:$("#content tr:nth-child(4) a").html()||null,main_coordinates:$("#content tr:nth-child(3) a").html().replace(/\[(.*)\]/,"$1"),score_building:getInt($("#content tr:nth-child(6) td:nth-child(2)").html()),score_science:getInt($("#content tr:nth-child(7) td:nth-child(2)").html()),score_military:getInt($("#content tr:nth-child(8) td:nth-child(2)").html()),score_defense:getInt($("#content tr:nth-child(9) td:nth-child(2)").html()),score:getInt($("#content tr:nth-child(10) td:nth-child(2)").html()),combats_won:getInt($("#content tr:nth-child(13) td:nth-child(2)").html()),combats_draw:getInt($("#content tr:nth-child(14) td:nth-child(2)").html()),combats_lost:getInt($("#content tr:nth-child(15) td:nth-child(2)").html()),combats_total:getInt($("#content tr:nth-child(16) td:nth-child(2)").html()),units_shot:getInt($("#content tr:nth-child(18) td:nth-child(2)").html()),units_lost:getInt($("#content tr:nth-child(19) td:nth-child(2)").html()),rubble_metal:getInt($("#content tr:nth-child(20) td:nth-child(2)").html()),rubble_crystal:getInt($("#content tr:nth-child(21) td:nth-child(2)").html())},function(e){});var a=$("table");a.append('<tr><th colspan="3">Planeten</th></tr>'),getJSON("players/"+t+"/planets",function(e){200===e.status&&$.each(JSON.parse(e.responseText),function(e,t){a.append('<tr><td colspan="3" style="text-align: left">'+t.coordinates+"</td></tr>")})})},window.parsePageAlliance=function(){var e=window.location.href.match(/[\?\&]id=([(0-9]+)/i)[1],t=$($("content table")[0]);t.append('<tr><th colspan="2">Planeten</th></tr>'),getJSON("alliances/"+e+"/planets",function(e){200===e.status&&$.each(JSON.parse(e.responseText),function(e,a){t.append('<tr><td style="text-align: left">'+a.coordinates+'</td><td style="text-align: left">'+a.name+"</td></tr>")})})},window.getRgb=function(e){return"rgb("+e[0]+", "+e[1]+", "+e[2]+")"},window.getPlayerRowStyle=function(e,t){return 1===e.on_vacation?{background:getRgb(d)}:null!==f&&null!==f.alliance_id&&f.alliance_id===e.alliance_id?{background:getRgb(o)}:1===e.is_inactive?{background:getRgb(g)}:getInt(e.score)<t/5?{background:getRgb(r)}:getInt(e.score)>5*t?{background:getRgb(l)}:{}},window.getPlayerRowTdStyle=function(e,t){return 1===e.on_vacation?{color:getRgb(d)}:null!==f&&null!==f.alliance_id&&f.alliance_id===e.alliance_id?{color:getRgb(o)}:1===e.is_inactive?{color:getRgb(g)}:getInt(e.score)<getInt(t)/5?{color:getRgb(r)}:getInt(e.score)>5*getInt(t)?{color:getRgb(l)}:{}},window.getColorIntensity=function(e,t){var a=e/t*255;return a>255?255:a},window.getColor=function(e,t){var a=[255,255,255],i=t,n=1-(i=(i=i<0?0:i)>1?1:i);n=(n=n>1?1:n)<0?0:n;var l=[Math.round(e[0]*i+a[0]*n),Math.round(e[1]*i+a[1]*n),Math.round(e[2]*i+a[2]*n)];return"rgb("+l[0]+", "+l[1]+", "+l[2]+")"},window.getPlayerAttributeStyle=function(e,t,a,i){let n=1;return x[a]&&x[a].enabled?n=x[a].threshold:t&&t[a]&&(n=getInt(t[a])),{color:getColor(i,getInt(e[a])/n)}},window.getPlayerScoreStyle=function(e,t){return getPlayerAttributeStyle(e,t,"score",d)},window.getPlayerScoreBuildingStyle=function(e,t){return getPlayerAttributeStyle(e,t,"score_building",o)},window.getPlayerScoreScienceStyle=function(e,t){return getPlayerAttributeStyle(e,t,"score_science",s)},window.getPlayerScoreMilitaryStyle=function(e,t){return getPlayerAttributeStyle(e,t,"score_military",l)},window.getPlayerScoreDefenseStyle=function(e,t){return getPlayerAttributeStyle(e,t,"score_defense",c)},window.getProgressBar=function(){const e=$("#progress-bar");return 1===e.length?e:($("body").prepend('<div style="padding: 10px 15px; background: '+getRgb(d)+"; color: "+getRgb(n)+'; z-index: 10000; position: fixed; top: 0; left: 0; right: 0;" id="progress-bar"></div>'),$("#progress-bar"))},window.processQueue=function(){if(y.length>0){getProgressBar().html("Updating "+y.length+" items ...");var e=y.shift();$("content").append('<iframe class="player-iframe" id="iframe'+e+'" width="1" height="1" src="/game.php?page=playerCard&id='+e+'"></iframe>'),$("#iframe"+e).on("load",processQueue),$("#iframe"+e).animate({left:0},1e3,function(){$(this).remove()})}else getProgressBar().html("Save & reload"),$("body").animate({opacity:0},1e3,function(){window.location.reload()})},window.showMessage=function(e,t){let a,i;switch(t){case"danger":a="#161618",i="#d23c22";break;default:a="#161618",i="#5cb85c"}$("#alertBox").remove(),$("body").prepend('<div id="alertBox" style="padding: 25px 15px; background: '+a+"; color: "+i+'; z-index: 10000; position: fixed; top: 0; left: 0; right: 0; opacity: 0; text-align: center; font-weight: bold;">'+e+"</div>"),$("#alertBox").animate({opacity:1},250).animate({opacity:1},2500).animate({opacity:0},500,function(){$(this).remove()})},window.showSpyReportHistory=function(e){$("body").append('<div id="spyReportBackdrop" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.95); z-index: 10000"></div>'),$("body").append('<div id="spyReportOverlay" style="position: fixed; top: 25px; left: 25px; right: 25px; max-height: 95%; z-index: 10000; background: #161618; overflow-y: auto"></div>');var t=$("#spyReportOverlay"),a="";a+=showSpyReportHistoryBox(e,"resources"),a+=showSpyReportHistoryBox(e,"fleet"),a+=showSpyReportHistoryBox(e,"defense"),a+=showSpyReportHistoryBox(e,"science"),a+=showSpyReportHistoryBox(e,"buildings"),$(t).html(a),$(window).keydown(function(e){"Escape"===e.key&&($("#spyReportOverlay").remove(),$("#spyReportBackdrop").remove())}),$("#spyReportBackdrop").click(function(){$("#spyReportOverlay").remove(),$("#spyReportBackdrop").remove()})},window.showSpyReportHistoryBox=function(e,t){var a='<table width="100%" style="max-width: 100% !important" class="table519"><tr>';return a+='<th style="text-align: left; width: 250px" width="200">Zeit</th>',$(e[t].data[0].values).each(function(e,t){a+='<th style="text-align: center;">'+t.name+"</th>"}),a+="</tr>",$(e[t].data).each(function(e,t){a+="<tr>",a+='<td style="text-align: left;">'+t.timestamp+"</td>",$(t.values).each(function(e,t){t.value=null===t.value?"---":t.value,a+='<td style="position: relative; '+("0"!==t.value.toString()&&"---"!==t.value.toString()?"color: #fff":"color: #444")+'">',a+=t.value,null===t.difference||0===t.difference||t.valueBefore===t.value||(t.valueBefore&&t.valueBefore>t.value?a+=' <span style="color: '+getRgb(l)+'; position: absolute; right: 15px">'+t.difference+"</span>":a+=' <span style="color: '+getRgb(o)+'; position: absolute; right: 15px">+'+t.difference+"</span>"),a+="</td>"}),a+="</tr>"}),a+="</table>"},window.getInt=function(e){return parseInt((null!=e&&""!==e?e:"0").toString().replace(/\./,""))};let x={},S=GM_getValue("filter_inactive")||"ALL",I=GM_getValue("filter_noobs")||"ALL",M=GM_getValue("filter_vacation")||"ALL",k=GM_getValue("filter_alliance")||"ALL",G=GM_getValue("filter_spy_report")||"ALL",V=GM_getValue("filter_last_battle_report")||"ALL",R=GM_getValue("filter_score_enable")||"0",A=GM_getValue("filter_score_min")||"",O=GM_getValue("filter_score_max")||"",L=GM_getValue("filter_score_building_enable")||"0",P=GM_getValue("filter_score_building_min")||"",H=GM_getValue("filter_score_building_max")||"",D=GM_getValue("filter_score_science_enable")||"0",B=GM_getValue("filter_score_science_min")||"",N=GM_getValue("filter_score_science_max")||"",z=GM_getValue("filter_score_fleet_enable")||"0",C=GM_getValue("filter_score_fleet_min")||"",E=GM_getValue("filter_score_fleet_max")||"",T=GM_getValue("filter_score_defense_enable")||"0",K=GM_getValue("filter_score_defense_min")||"",F=GM_getValue("filter_score_defense_max")||"",J=GM_getValue("filter_inactive_since_enable")||"0",Y=GM_getValue("filter_inactive_since_min")||"",U=GM_getValue("filter_inactive_since_max")||"",j=GM_getValue("filter_last_battle_report_enable")||"0",q=GM_getValue("filter_last_battle_report_min")||"",Q=GM_getValue("filter_last_battle_report_max")||"",W=GM_getValue("filter_last_spy_report_enable")||"0",Z=GM_getValue("filter_last_spy_report_min")||"",X=GM_getValue("filter_last_spy_report_max")||"",ee=GM_getValue("filter_metal_enable")||"0",te=GM_getValue("filter_metal_min")||"",ae=GM_getValue("filter_metal_max")||"",ie=GM_getValue("filter_crystal_enable")||"0",ne=GM_getValue("filter_crystal_min")||"",le=GM_getValue("filter_crystal_max")||"",re=GM_getValue("filter_deuterium_enable")||"0",se=GM_getValue("filter_deuterium_min")||"",oe=GM_getValue("filter_deuterium_max")||"";window.updateConfigVars=function(){x={score:{enabled:"1"===(GM_getValue("highlight_score_enable")||"0"),threshold:getInt(GM_getValue("highlight_score_value")||"")},score_building:{enabled:"1"===(GM_getValue("highlight_score_building_enable")||"0"),threshold:getInt(GM_getValue("highlight_score_building_value")||"")},score_science:{enabled:"1"===(GM_getValue("highlight_score_science_enable")||"0"),threshold:getInt(GM_getValue("highlight_score_science_value")||"")},score_military:{enabled:"1"===(GM_getValue("highlight_score_military_enable")||"0"),threshold:getInt(GM_getValue("highlight_score_military_value")||"")},score_defense:{enabled:"1"===(GM_getValue("highlight_score_defense_enable")||"0"),threshold:getInt(GM_getValue("highlight_score_defense_value")||"")}},S=GM_getValue("filter_inactive")||"ALL",I=GM_getValue("filter_noobs")||"ALL",M=GM_getValue("filter_vacation")||"ALL",k=GM_getValue("filter_alliance")||"ALL",G=GM_getValue("filter_spy_report")||"ALL",V=GM_getValue("filter_last_battle_report")||"ALL",R=GM_getValue("filter_score_enable")||"0",A=GM_getValue("filter_score_min")||"",O=GM_getValue("filter_score_max")||"",L=GM_getValue("filter_score_building_enable")||"0",P=GM_getValue("filter_score_building_min")||"",H=GM_getValue("filter_score_building_max")||"",D=GM_getValue("filter_score_science_enable")||"0",B=GM_getValue("filter_score_science_min")||"",N=GM_getValue("filter_score_science_max")||"",z=GM_getValue("filter_score_fleet_enable")||"0",C=GM_getValue("filter_score_fleet_min")||"",E=GM_getValue("filter_score_fleet_max")||"",T=GM_getValue("filter_score_defense_enable")||"0",K=GM_getValue("filter_score_defense_min")||"",F=GM_getValue("filter_score_defense_max")||"",J=GM_getValue("filter_inactive_since_enable")||"0",Y=GM_getValue("filter_inactive_since_min")||"",U=GM_getValue("filter_inactive_since_max")||"",j=GM_getValue("filter_last_battle_report_enable")||"0",q=GM_getValue("filter_last_battle_report_min")||"",Q=GM_getValue("filter_last_battle_report_max")||"",W=GM_getValue("filter_last_spy_report_enable")||"0",Z=GM_getValue("filter_last_spy_report_min")||"",X=GM_getValue("filter_last_spy_report_max")||"",ee=GM_getValue("filter_metal_enable")||"0",te=GM_getValue("filter_metal_min")||"",ae=GM_getValue("filter_metal_max")||"",ie=GM_getValue("filter_crystal_enable")||"0",ne=GM_getValue("filter_crystal_min")||"",le=GM_getValue("filter_crystal_max")||"",re=GM_getValue("filter_deuterium_enable")||"0",se=GM_getValue("filter_deuterium_min")||"",oe=GM_getValue("filter_deuterium_max")||""},window.getOverviewHeader=function(){let e='<table cellspacing="0"><tr><td width="50%%" style="text-align: left; padding: 5px 10px">';return e+='<a href="https://pr0game-hub.eskju.net/download/legend.png" target="_blank"><i class="fa fa-info-circle"></i> Legende</a>',e+=" // ",e+='<a href="https://pr0game-hub.eskju.net/download/faq.txt" target="_blank"><i class="fa fa-question-circle"></i> FAQ</a>',e+="</td>","1"===GM_getValue("hideSettings")?e+='<td id="showSettings" style="text-align: right; padding: 5px 10px; cursor: pointer;"><i class="fa fa-cogs fa"></i> Einstellungen anzeigen</td>':e+='<td id="hideSettings" style="text-align: right; padding: 5px 10px; cursor: pointer;"><span style="color: lightgreen"><i class="fa fa-cogs"></i> Einstellungen ausblenden</span></td>',e+="</tr></table>",e+=displayOverviewSettings()};var de="";window.checkRequirements=function(){return!!GM_getValue("api_keys")||(de="Bitte hinterlege den API Key, den du von @eichhorn#1526 erhalten hast.",!1)},window.showSetupDialog=function(){$("head").append('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">'),$(".wrapper").css("filter","blur(5px)"),$("body").append('<div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.95); z-index: 10000"></div>'),$("body").append('<div id="configOverlay" style="position: fixed; top: 25px; left: 25px; right: 25px; max-height: 95%; z-index: 10000; background: #161618; overflow-y: auto; padding: 25px 50px;"></div>');const e=$("#configOverlay");$(e).append('<p><b style="color: #fff">Willkommen bei pr0gameHub!</b></p>'),$(e).append('<p style="color: rgb(0, 255, 255)">Für bisherige User: Damit das Updaten leichter wird, kann der API Key nun im lokalen Speicher hinterlegt werden. So muss die Updatedatei nicht mehr editiert werden.</p><br><br>'),$(e).append('<div class="alert alert-info">'+de+"</div>"),$(e).append('<div class="input-group"><input id="apiKey" type="text" placeholder="Dein API Key" class="form-control" style="text-align: left"><div id="apiKeySave" class="input-group-append"><a class="btn btn-success" href="javascript:void(0)">prüfen &amp; speichern</a></div></div>'),$("#apiKeySave").click(saveApiKey),$("#apiKeySave").on("keypress",function(e){13==e.which&&saveApiKey()})},window.saveApiKey=function(e){var t=a+"login?api_key="+$("#apiKey").val()+"&version=0.3.7";GM_xmlhttpRequest({method:"GET",url:t,onload:function(e){200!==e.status&&(de="Der API Key ist ungültig.",showSetupDialog())}}),GM_setValue("api_key",$("#apiKey").val())},window.displayOverviewSettings=function(){let e="";return e+='<table id="phSettings" width="100%" style="max-width: 100% !important; '+("1"===GM_getValue("hideSettings")?"display: none":"")+'" class="table519">',e+='<tr><th colspan="4">API</th></tr>',e+='<tr><td colspan="4"><p style="font-size: 11px; text-align: left;">Solltest Du keinen API Key besitzen, wende Dich bitte per Discord an @eichhorn#1526.<br><b style="color: '+getRgb(l)+'">Gib Deinen API Key nicht an andere weiter!</b></p></td></tr>',e+="<tr>",e+='<td width="50%" style="text-align: left">API Key</td>',e+='<td colspan="3"><input class="phFilter" data-alias="api_key" type="text" style="width: 100%" placeholder="API Key" value="'+(GM_getValue("api_key")||"")+'"></td>',e+="<tr>",e+='<td width="50%" style="text-align: left">Debug-Modus</td>',e+='<td><input type="checkbox" class="phFilter" data-alias="debug_mode" value="1" '+("1"===GM_getValue("debug_mode")?"checked":"")+'></td><td colspan="2" style="text-align: left; color: #888">Zeige Infos in der Konsole</td>',e+="<tr>",e+='<td width="50%" style="text-align: left">Developer-Modus</td>',e+='<td><input type="checkbox" class="phFilter" data-alias="developer_mode" value="1" '+("1"===GM_getValue("developer_mode")?"checked":"")+'></td><td colspan="2" style="text-align: left; color: #888">Nutzt die Entwickler-API (nur zum Coden!)</td>',e+="<tr>",e+='<td width="50%" style="text-align: left">Leserliches Datumsformat</td>',e+='<td><input type="checkbox" class="phFilter" data-alias="date_for_humans" value="1" '+("1"===GM_getValue("date_for_humans")?"checked":"")+'></td><td colspan="2" style="text-align: left; color: #888">z.B. "vor 5min" statt Datum/Uhrzeit. Erfordert Reload (F5)!</td>',e+='<tr><th colspan="4">HIGHLIGHTING</th></tr>',e+='<tr><td colspan="4"><p style="font-size: 11px; text-align: left;">Standardmäßig werden die Spielerwerte als Referenz genommen; Für Galaxie/System/Planet wird standardmäßig der aktive Planet gesetzt. Ist die Checkbox angehakt, wird der jeweilige Wert vom Eingetragenen überschrieben. Die Spieler-Werte werden in der Farbskala weiß (0 Punkte) bis Farbe (gesetztes Punktelimit) dargestellt.</p></td></tr>',e+=displayOverviewHighlight("Gesamtpunkte","highlight_score",d),e+=displayOverviewHighlight("Gebäudepunkte","highlight_score_building",o),e+=displayOverviewHighlight("Forschungspunkte","highlight_score_science",s),e+=displayOverviewHighlight("Militärpunkte","highlight_score_military",l),e+=displayOverviewHighlight("Verteidigungspunkte","highlight_score_defense",c),e+='<tr><th colspan="4">FILTER</th></tr>',e+=displayOverviewSettingsSelect(getHotkeyIcon("I")+"Inaktive Spieler","filter_inactive",{ALL:"Anzeigen",HIDE:"Ausblenden",ONLY:"Andere ausblenden"}),e+=displayOverviewSettingsSelect(getHotkeyIcon("N")+"Spieler mit Noobschutz","filter_noobs",{ALL:"Anzeigen",HIDE:"Ausblenden",ONLY:"Andere ausblenden"}),e+=displayOverviewSettingsSelect(getHotkeyIcon("U")+"Spieler im Urlaubsmodus","filter_vacation",{ALL:"Anzeigen",HIDE:"Ausblenden",ONLY:"Andere ausblenden"}),e+=displayOverviewSettingsSelect(getHotkeyIcon("A")+"Spieler der Allianz","filter_alliance",{ALL:"Anzeigen",HIDE:"Ausblenden",ONLY:"Andere ausblenden"}),e+=displayOverviewSettingsSelect(getHotkeyIcon("S")+"Spieler mit Spiobericht","filter_spy_report",{ALL:"Anzeigen",HIDE:"Ausblenden",ONLY:"Andere ausblenden"}),e+=displayOverviewSettingsSelect(getHotkeyIcon("K")+"Spieler mit Kampfbericht","filter_battle_report",{ALL:"Anzeigen",HIDE:"Ausblenden",ONLY:"Andere ausblenden"}),e+='<tr><th colspan="4">THRESHOLDS</th></tr>',e+=displayOverviewSettingsRange(getHotkeyIcon("P",!0)+"Punkte","filter_score"),e+=displayOverviewSettingsRange(getHotkeyIcon("G",!0)+"Gebäudepunkte","filter_score_building"),e+=displayOverviewSettingsRange(getHotkeyIcon("F",!0)+"Forschungspunkte","filter_score_science"),e+=displayOverviewSettingsRange(getHotkeyIcon("M",!0)+"Militärpunkte","filter_score_fleet"),e+=displayOverviewSettingsRange(getHotkeyIcon("V",!0)+"Verteidigungspunkte","filter_score_defense"),e+=displayOverviewSettingsRange(getHotkeyIcon("I",!0)+"Inaktiv seit ... Stunden","filter_inactive_since"),e+=displayOverviewSettingsRange(getHotkeyIcon("K",!0)+"Stunden seit letztem Kampfbericht","filter_last_battle_report"),e+=displayOverviewSettingsRange(getHotkeyIcon("S",!0)+"Stunden seit letztem Spionagebericht","filter_last_spy_report"),e+=displayOverviewSettingsRange(getHotkeyIcon("Q",!0)+"Metall (letzte Spionage)","filter_metal"),e+=displayOverviewSettingsRange(getHotkeyIcon("W",!0)+"Kristall (letzte Spionage)","filter_crystal"),e+=displayOverviewSettingsRange(getHotkeyIcon("E",!0)+"Deuterium (letzte Spionage)","filter_deuterium"),e+="</table>"},window.getHotkeyIcon=function(e,t=!1){let a="";return t&&(a=getHotkeyIcon('<i class="fa fa-arrow-up"></i>')),a+'<span style="width: 21px; outline: 1px solid '+getRgb(l)+"; outline-offset: -1px; display: inline-block; font-size: 10px; line-height: 21px; text-align: center; margin-right: 5px; border-radius: 2px; background: "+getRgb(i)+"; color: "+getRgb(l)+'">'+e+"</span>"},window.displayOverviewHighlight=function(e,t,a){let i="<tr>";return i+='<td width="50%" style="text-align: left; color: '+getRgb(a)+'">'+e+"</td>",i+='<td width="4%">',i+='<input id="'+t+'" class="phFilter" data-alias="'+t+'_enable" value="1" type="checkbox" '+("1"===GM_getValue(t+"_enable")?"checked":"")+">",i+="</td>",i+='<td width="46%" colspan="2">',i+='<input id="'+t+'_value" class="phFilter" data-alias="'+t+'_value" style="width: 100%" placeholder="Schwellwert" value="'+(GM_getValue(t+"_value")||"")+'">',i+="</td>",i+="</tr>"},window.displayOverviewSettingsSelect=function(e,t,a){let i="<tr>";return i+='<td width="50%" style="text-align: left">'+e+"</td>",i+='<td colspan="3">',i+='<select id="'+t+'_select" class="phFilter" data-alias="'+t+'" style="width: 100%">',$.each(a,function(e,a){i+='<option value="'+e+'" '+(GM_getValue(t)===e?"selected":"")+">"+a+"</option>"}),i+="</select>",i+="</td>"},window.displayOverviewSettingsRange=function(e,t){let a="<tr>";return a+='<td width="50%" style="text-align: left">'+e+"</td>",a+='<td width="4%">',a+='<input id="'+t+'_enable" class="phFilter" data-alias="'+t+'_enable" value="1" type="checkbox" '+("1"===GM_getValue(t+"_enable")?"checked":"")+">",a+="</td>",a+='<td width="23%">',a+='<input id="'+t+'_min" class="phFilter" data-alias="'+t+'_min" style="width: 100%" placeholder="min" value="'+(GM_getValue(t+"_min")||"")+'">',a+="</td>",a+='<td width="23%">',a+='<input id="'+t+'_max" class="phFilter" data-alias="'+t+'_max" style="width: 100%" placeholder="max" value="'+(GM_getValue(t+"_max")||"")+'">',a+="</td>"},window.filterTableRow=function(e,t){if("HIDE"===S&&1===e.player.is_inactive)return!1;if("ONLY"===S&&0===e.player.is_inactive)return!1;if(null!==t){if("HIDE"===I&&0===e.player.is_inactive&&getInt(e.player.score)<getInt(t.score)/5)return!1;if("ONLY"===I&&0===e.player.is_inactive&&getInt(e.player.score)>=getInt(t.score)/5)return!1}if("HIDE"===M&&1===e.player.on_vacation)return!1;if("ONLY"===M&&0===e.player.on_vacation)return!1;if(t){if("HIDE"===k&&null!==e.player.alliance_id&&e.player.alliance_id===t.alliance_id)return!1;if("ONLY"===k&&(null===e.player.alliance_id||e.player.alliance_id!==t.alliance_id))return!1}return("HIDE"!==G||""===e.last_spy_report)&&(("ONLY"!==G||""!==e.last_spy_report)&&(("HIDE"!==V||""===e.last_battle_report)&&(("ONLY"!==V||""!==e.last_battle_report)&&(!("1"===R&&getInt(A)>0&&getInt(A)>getInt(e.player.score))&&(!("1"===R&&getInt(O)>0&&getInt(O)<getInt(e.player.score))&&(!("1"===L&&getInt(P)>0&&getInt(P)>getInt(e.player.score_building))&&(!("1"===L&&getInt(H)>0&&getInt(H)<getInt(e.player.score_building))&&(!("1"===D&&getInt(B)>0&&getInt(B)>getInt(e.player.score_science))&&(!("1"===D&&getInt(N)>0&&getInt(N)<getInt(e.player.score_science))&&(!("1"===z&&getInt(C)>0&&getInt(C)>getInt(e.player.score_military))&&(!("1"===z&&getInt(E)>0&&getInt(E)<getInt(e.player.score_military))&&(!("1"===T&&getInt(K)>0&&getInt(K)>getInt(e.player.score_defense))&&(!("1"===T&&getInt(F)>0&&getInt(F)<getInt(e.player.score_defense))&&(!("1"===J&&getInt(Y)>0&&getInt(Y)>getInt(e.inactive_since))&&(!("1"===J&&getInt(U)>0&&getInt(U)<getInt(e.inactive_since))&&(!("1"===j&&getInt(q)>0&&getInt(q)>getInt(e.last_battle_report_hours))&&(!("1"===j&&getInt(Q)>0&&getInt(Q)<getInt(e.last_battle_report_hours))&&(!("1"===W&&getInt(Z)>0&&getInt(Z)>getInt(e.last_spy_report_hours))&&(!("1"===W&&getInt(X)>0&&getInt(X)<getInt(e.last_spy_report_hours))&&(!("1"===ee&&getInt(te)>0&&getInt(te)>getInt(e.last_spy_metal))&&(!("1"===ee&&getInt(ae)>0&&getInt(ae)<getInt(e.last_spy_metal))&&(!("1"===ie&&getInt(ne)>0&&getInt(ne)>getInt(e.last_spy_crystal))&&(!("1"===ie&&getInt(le)>0&&getInt(le)<getInt(e.last_spy_crystal))&&(!("1"===re&&getInt(se)>0&&getInt(se)>getInt(e.last_spy_deuterium))&&!("1"===re&&getInt(oe)>0&&getInt(oe)<getInt(e.last_spy_deuterium))))))))))))))))))))))))))},window.savePhOption=function(e,t){GM_setValue(e,t),m.renderHtml()},parseUrl()}();
